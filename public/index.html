<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–ª–∏–∫–µ—Ä</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body style="background: url(assets/background.jpg) no-repeat center center fixed; background-size: cover;">
<body>
    <div class="page-container">
        <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
        <div id="main-page" class="page">
            <header class="header">
                <div class="header-content">
                    <div class="brand-section-main">
                        <h1 class="logo">–°–æ–∫—Ä–∞—Ç–∏—Ç–µ–ª—å —Å—Å—ã–ª–æ–∫</h1>
                        <p class="description">–ü—Ä–∏ –ø–æ–º–æ—â–∏ —ç—Ç–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–ª–∏–Ω–Ω—É—é —Å—Å—ã–ª–∫—É –∫–æ—Ä–æ—Ç–∫–æ–π.<br>
                            –í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º.</p>
                    </div>
                    <button class="login-button" onclick="showLoginPage()">–í–æ–π—Ç–∏</button>
                </div>
                </header>

                <main class="main-content">
                    <div class="url-input-section">
                        <input id="url" class="enter-url" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –¥–ª—è —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è">
                        <button class="submit-button" onclick="create()">–°–æ–∫—Ä–∞—Ç–∏—Ç—å</button>
                    </div>
                    <div id="result" class="result-area"></div>
                </main>
        </div>
                <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
        <div id="login-page" class="page" style="display: none;">
            <header class="header">
                <div class="header-content">
                    <div class="brand-section">
                        <h1 class="logo">–°–æ–∫—Ä–∞—Ç–∏—Ç–µ–ª—å —Å—Å—ã–ª–æ–∫</h1>
                    </div>
                    <button class="back-link" onclick="showMainPage()">‚Üê –ù–∞–∑–∞–¥</button>
                </div>
            </header>

            <main class="main-content">
                <div class="login-form-section">
                    <form id="loginForm" class="login-form">
                        <div class="form-group">
                            <input type="text" id="username" class="form-input" placeholder="–ê–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã" required>
                        </div>
                        <div class="form-group">
                            <div class="password-input-wrapper">
                                <input type="password" id="password" class="form-input" placeholder="–ü–∞—Ä–æ–ª—å" required>
                                <button type="button" class="password-toggle" onclick="togglePassword()">
                                    <span id="password-icon">üëÅÔ∏è</span>
                                </button>
                            </div>
                        </div>
                        <button type="submit" class="submit-button">–í–æ–π—Ç–∏</button>
                        <div class="register-link" onclick="showRegisterPage()">
                            –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç
                        </div>
                        <div class="forgot-password-link" onclick="showForgotPasswordPage()">
                            –ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?
                        </div>
                    </form>
                </div>
            </main>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
        <div id="register-page" class="page" style="display: none;">
            <header class="header">
                <div class="header-content">
                    <div class="brand-section">
                        <h1 class="logo">–ö–ª–∏–∫–µ—Ä</h1>
                    </div>
                    <button class="back-link" onclick="showLoginPage()">‚Üê –ù–∞–∑–∞–¥</button>
                </div>
                <p class="description">–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º.</p>
            </header>

            <main class="main-content">
                <div class="login-form-section">
                    <form id="registerForm" class="login-form">
                        <div class="form-group">
                            <input type="text" id="reg-username" class="form-input" placeholder="–ê–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã" required>
                        </div>
                        <div class="form-group">
                            <div class="password-input-wrapper">
                                <input type="password" id="reg-password" class="form-input" placeholder="–ü–∞—Ä–æ–ª—å" required>
                                <button type="button" class="password-toggle" onclick="toggleRegisterPassword()">
                                    <span id="reg-password-icon">üëÅÔ∏è</span>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="password-input-wrapper">
                                <input type="password" id="reg-password-confirm" class="form-input" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                                <button type="button" class="password-toggle" onclick="toggleRegisterPasswordConfirm()">
                                    <span id="reg-password-confirm-icon">üëÅÔ∏è</span>
                                </button>
                            </div>
                        </div>
                        <button type="submit" class="submit-button">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
                        <div class="register-link" onclick="showLoginPage()">
                            –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏
                        </div>
                    </form>
                </div>
            </main>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è -->
        <div id="forgot-password-page" class="page" style="display: none;">
            <header class="header">
                <div class="header-content">
                    <div class="brand-section">
                        <h1 class="logo">–ö–ª–∏–∫–µ—Ä</h1>
                        <p class="description">–í–≤–µ–¥–∏—Ç–µ –≤–∞—à email –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è.</p>
                    </div>
                    <button class="back-link" onclick="showLoginPage()">‚Üê –ù–∞–∑–∞–¥</button>
                </div>
            </header>
            
            <main class="main-content">
                <div class="login-form-section">
                    <form id="forgotPasswordForm" class="login-form" autocomplete="off">
                        <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ-–ª–æ–≤—É—à–∫–∞ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π -->
                        <input type="password" style="display:none" autocomplete="new-password">
                        <div class="form-group">
                            <input type="email" id="forgot-email" class="form-input" placeholder="Email" required autocomplete="email">
                        </div>
                        <button type="submit" class="submit-button">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –¥–ª—è —Å–±—Ä–æ—Å–∞</button>
                        <div class="register-link" onclick="showLoginPage()">
                            –í—Å–ø–æ–º–Ω–∏–ª–∏ –ø–∞—Ä–æ–ª—å? –í–æ–π—Ç–∏
                        </div>
                    </form>
                </div>
            </main>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è -->
        <div id="reset-password-page" class="page" style="display: none;">
            <header class="header">
                <div class="header-content">
                    <div class="brand-section">
                        <h1 class="logo">–ö–ª–∏–∫–µ—Ä</h1>
                        <p class="description">–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å.</p>
                    </div>
                </div>
            </header>
            
            <main class="main-content">
                <div class="login-form-section">
                    <form id="resetPasswordForm" class="login-form">
                        <div class="form-group">
                            <div class="password-input-wrapper">
                                <input type="password" id="new-password" class="form-input" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" required>
                                <button type="button" class="password-toggle" onclick="toggleNewPassword()">
                                    <span id="new-password-icon">üëÅÔ∏è</span>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="password-input-wrapper">
                                <input type="password" id="new-password-confirm" class="form-input" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" required>
                                <button type="button" class="password-toggle" onclick="toggleNewPasswordConfirm()">
                                    <span id="new-password-confirm-icon">üëÅÔ∏è</span>
                                </button>
                            </div>
                        </div>
                        <button type="submit" class="submit-button">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
                    </form>
                </div>
            </main>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email -->
        <div id="email-confirmed-page" class="page" style="display: none;">
            <header class="header">
                <div class="header-content">
                    <div class="brand-section">
                        <h1 class="logo">–ö–ª–∏–∫–µ—Ä</h1>
                        <p class="description">–í–∞—à –∞–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω!</p>
                    </div>
                </div>
            </header>
            
            <main class="main-content">
                <div class="login-form-section">
                    <div class="success-message">
                        <div class="success-icon">‚úÖ</div>
                        <h2>–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</h2>
                        <p>–í–∞—à –∞–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã —É—Å–ø–µ—à–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω.</p>
                        <p>–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç.</p>
                        <button class="submit-button" onclick="showLoginPage()">–í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç</button>
                    </div>
                </div>
            </main>
        </div>

        <!-- –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç -->
        <div id="dashboard-page" class="page" style="display: none;">
            <header class="header">
                <div class="header-content">
                    <div class="brand-section">
                        <button class="home-button" onclick="showMainPage()">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
                        <button class="logout-button" onclick="logout()">–í—ã–π—Ç–∏</button>
                    </div>
                </div>
            </header>
            <main class="main-content">
                <div class="dashboard-content">
                    <h2 class="dashboard-title">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h2>
                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–º –∞–∫–∫–∞—É–Ω—Ç–µ -->
                    <div class="account-info">
                        <div class="account-card">
                            <div class="account-label">–í–∞—à –∞–∫–∫–∞—É–Ω—Ç:</div>
                            <div class="account-email" id="current-user-email">loading...</div><br>
                            <button class="change-password-button" onclick="sendPasswordResetEmail()">
                                –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
                            </button>
                        </div>
                    </div>

                    <!-- –ò—Å—Ç–æ—Ä–∏—è —Å—Å—ã–ª–æ–∫ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ -->
                    <div id="dashboard-history" class="url-history">
                        <div class="history-header">
                            <h3 class="history-title">–ò—Å—Ç–æ—Ä–∏—è –≤–∞—à–∏—Ö —Å—Å—ã–ª–æ–∫</h3>

                            <label class="toggle">
                                <input type="checkbox" id="dashboard-include-my-clicks" checked onchange="toggleDashboardMyClicks()">
                                <span class="toggle-track">
                                <span class="toggle-thumb"></span>
                                </span>
                                <span class="text-near-toggle-history">–£—á–∏—Ç—ã–≤–∞—Ç—å –º–æ–∏ –ø–µ—Ä–µ—Ö–æ–¥—ã</span>
                            </label>

                        </div>

                        <div id="dashboard-history-list" class="history-list">
                            <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å–ø–∏—Å–æ–∫ —Å—Å—ã–ª–æ–∫ -->
                        </div>
                    </div>
                </div>
            </main>
        </div>
        
        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
        <div id="change-password-page" class="page" style="display: none;">
            <header class="header">
                <div class="header-content">
                    <div class="brand-section">
                        <button class="home-button" onclick="showDashboard()">‚Üê –ù–∞–∑–∞–¥ –∫ –∫–∞–±–∏–Ω–µ—Ç—É</button>
                        <p class="description">–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è</p>
                    </div>
                </div>
            </header>
            
            <main class="main-content">
                <div class="login-form-section">
                    <form id="changePasswordForm" class="login-form" autocomplete="off">
                        <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ-–ª–æ–≤—É—à–∫–∞ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π -->
                        <input type="password" style="display:none" autocomplete="new-password">
                        <div class="form-group">
                            <div class="password-input-wrapper">
                                <input type="password" id="change-new-password" class="form-input" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" required autocomplete="new-password">
                                <button type="button" class="password-toggle" onclick="toggleChangeNewPassword()">
                                    <span id="change-new-password-icon">üëÅÔ∏è</span>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="password-input-wrapper">
                                <input type="password" id="change-new-password-confirm" class="form-input" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" required autocomplete="new-password">
                                <button type="button" class="password-toggle" onclick="toggleChangeNewPasswordConfirm()">
                                    <span id="change-new-password-confirm-icon">üëÅÔ∏è</span>
                                </button>
                            </div>
                        </div>
                        <button type="submit" class="submit-button">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
                    </form>
                </div>
            </main>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å—Å—ã–ª–∫–∏ -->
        <div id="statistics-page" class="page" style="display: none;">
            <header class="header">
                <div class="header-content">
                    <div class="brand-section">
                        <button class="home-button" onclick="backToDashboard()">‚Üê –ù–∞–∑–∞–¥ –∫ –∫–∞–±–∏–Ω–µ—Ç—É</button>
                        <p class="description" id="stats-description">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –ø–æ —Å—Å—ã–ª–∫–µ</p>
                    </div>
                    <button class="logout-button" onclick="logout()">–í—ã–π—Ç–∏</button>
                </div>
            </header>

            <main class="main-content">
                <div class="statistics-content">
                    <h2 class="statistics-title" id="stats-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>

                    <div class="statistics-info">
                        <div class="stat-card">
                            <div class="stat-label">–ö–æ—Ä–æ—Ç–∫–∞—è —Å—Å—ã–ª–∫–∞:</div>
                            <div class="stat-value" id="stats-short-url"></div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:</div>
                            <div class="stat-value" id="stats-long-url"></div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">–í—Å–µ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤:</div>
                            <div class="stat-value" id="stats-total-clicks"></div>
                        </div>
                    </div>

                    <!-- –ì—Ä–∞—Ñ–∏–∫ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –ø–æ –¥–Ω—è–º -->
                    <div class="statistics-chart">
                        <h3 class="chart-title">–ì—Ä–∞—Ñ–∏–∫ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –ø–æ –¥–Ω—è–º</h3>
                        <!-- <div id="clicks-chart" class="chart-container"> -->
                            <div class="chart-container"> –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</div>
                            <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –≥—Ä–∞—Ñ–∏–∫ -->
                        </div>
                    </div>

                    <div class="statistics-history">
                        <div class="history-header">
                            <h3 class="history-title">–ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤</h3>
                            <label class="checkbox-container">
                                <input type="checkbox" id="include-my-clicks" checked onchange="toggleMyClicks()">
                                <span class="checkbox-label">–£—á–∏—Ç—ã–≤–∞—Ç—å –º–æ–∏ –ø–µ—Ä–µ—Ö–æ–¥—ã</span>
                            </label>
                        </div>
                        <div id="statistics-list" class="statistics-list">
                            <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ -->
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
        <div id="delete-modal" class="modal-overlay" style="display: none;">
            <div class="modal-content delete-modal">
                <div class="modal-header">
                    <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h3>
                    <button class="modal-close" onclick="closeDeleteModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="warning-icon">‚ö†Ô∏è</div>
                    <p class="warning-text">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å—Å—ã–ª–∫—É?</p>
                    <div class="warning-details">
                        <p>‚Ä¢ –°—Å—ã–ª–∫–∞ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–∞ –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è</p>
                        <p>‚Ä¢ –ù–∏–∫—Ç–æ –±–æ–ª—å—à–µ –Ω–µ —Å–º–æ–∂–µ—Ç –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –∏–∑–Ω–∞—á–∞–ª—å–Ω—ã–π —Å–∞–π—Ç –ø—Ä–∏ –ø–æ–º–æ—â–∏ —ç—Ç–æ–π —Å—Å—ã–ª–∫–∏</p>
                    </div>
                    <div class="delete-url-info">
                        <div class="delete-url-label">–ö–æ—Ä–æ—Ç–∫–∞—è —Å—Å—ã–ª–∫–∞:</div>
                        <div id="delete-url-short" class="delete-url-value"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="cancel-button" onclick="closeDeleteModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button class="delete-confirm-button" onclick="confirmDelete()">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–µ–º –∏—Å—Ç–µ—á–µ–Ω–∏—è -->
        <div id="expiration-modal" class="modal-overlay" style="display: none;">
            <div class="modal-content expiration-modal">
                <div class="modal-header">
                    <h3 id="expiration-modal-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ä–æ–∫–æ–º –¥–µ–π—Å—Ç–≤–∏—è —Å—Å—ã–ª–∫–∏</h3>
                    <button class="modal-close" onclick="closeExpirationModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="expiration-form">
                        <div class="form-section">
                            <h4>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è</h4>
                            <div class="datetime-inputs">
                                <div class="date-inputs">
                                    <label>–î–∞—Ç–∞:</label>
                                    <div class="date-row">
                                        <input type="number" id="exp-day" placeholder="–î–µ–Ω—å" min="1" max="31" class="date-input">
                                        <input type="number" id="exp-month" placeholder="–ú–µ—Å—è—Ü" min="1" max="12" class="date-input">
                                        <input type="number" id="exp-year" placeholder="–ì–æ–¥" min="2024" class="date-input">
                                    </div>
                                </div>
                                <div class="time-inputs">
                                    <label>–í—Ä–µ–º—è:</label>
                                    <div class="time-row">
                                        <input type="number" id="exp-hour" placeholder="–ß–∞—Å" min="0" max="23" class="time-input">
                                        <input type="number" id="exp-minute" placeholder="–ú–∏–Ω—É—Ç–∞" min="0" max="59" class="time-input">
                                    </div>
                                </div>
                            </div>
                            <div class="quick-actions">
                                <button class="quick-button" onclick="setQuickExpiration(1)">+1 –¥–µ–Ω—å</button>
                                <button class="quick-button" onclick="setQuickExpiration(7)">+1 –Ω–µ–¥–µ–ª—è</button>
                                <button class="quick-button" onclick="setQuickExpiration(30)">+1 –º–µ—Å—è—Ü</button>
                            </div>
                        </div>
                        
                        <div class="current-expiration" id="current-expiration-info" style="display: none;">
                            <h4>–¢–µ–∫—É—â–∏–π —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è</h4>
                            <div id="current-expiration-text" class="current-exp-text"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="cancel-button" onclick="closeExpirationModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button class="remove-expiration-button" id="remove-exp-btn" onclick="removeExpiration()" style="display: none;">–°–¥–µ–ª–∞—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π</button>
                    <button class="submit-button" onclick="setExpiration()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ä–æ–∫</button>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è slug'–∞ -->
        <div id="customize-slug-modal" class="modal-overlay" style="display: none;">
            <div class="modal-content customize-slug-modal">
                <div class="modal-header">
                    <h3>–ò–∑–º–µ–Ω–∏—Ç—å –∞–¥—Ä–µ—Å —Å—Å—ã–ª–∫–∏</h3>
                    <button class="modal-close" onclick="closeCustomizeSlugModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="customize-slug-form">
                        <div class="form-section">
                            <h4>–¢–µ–∫—É—â–∏–π –∞–¥—Ä–µ—Å</h4>
                            <div class="current-slug-display">
                                <span class="domain-part" id="current-domain"></span>
                                <span class="slug-part" id="current-slug-display"></span>
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <h4>–ù–æ–≤—ã–π –∞–¥—Ä–µ—Å</h4>
                            <div class="new-slug-input-wrapper">
                                <span class="domain-part" id="new-domain"></span>
                                <input type="text" id="new-slug-input" class="slug-input" placeholder="–≤–≤–µ–¥–∏—Ç–µ-–Ω–æ–≤—ã–π-–∞–¥—Ä–µ—Å">
                            </div>
                        </div>
                        
                        <div class="slug-preview" id="slug-preview" style="display: none;">
                            <h4>–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä</h4>
                            <div class="preview-url" id="preview-url"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="cancel-button" onclick="closeCustomizeSlugModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button class="submit-button" onclick="customizeSlug()">–ò–∑–º–µ–Ω–∏—Ç—å –∞–¥—Ä–µ—Å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞—Ä–æ–ª—è -->
    <div id="set-password-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content password-modal">
            <div class="modal-header">
                <h3>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å –Ω–∞ —Å—Å—ã–ª–∫—É</h3>
                <button class="modal-close" onclick="closeSetPasswordModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="password-info">
                    <div class="info-icon">üîí</div>
                    <p>–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞—Ä–æ–ª—è –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –ø–æ —Å—Å—ã–ª–∫–µ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –µ–≥–æ –≤–≤–æ–¥</p>
                </div>
                <div class="form-group">
                    <label for="new-slug-password">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="new-slug-password" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                        <button type="button" class="password-toggle" onclick="toggleNewSlugPassword()">
                            <span id="new-slug-password-icon">üëÅÔ∏è</span>
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="confirm-slug-password">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å:</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="confirm-slug-password" class="form-input" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                        <button type="button" class="password-toggle" onclick="toggleConfirmSlugPassword()">
                            <span id="confirm-slug-password-icon">üëÅÔ∏è</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="cancel-button" onclick="closeSetPasswordModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="submit-button" onclick="confirmSetPassword()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–¥–∞–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è -->
    <div id="remove-password-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content password-modal">
            <div class="modal-header">
                <h3>–£–¥–∞–ª–∏—Ç—å –ø–∞—Ä–æ–ª—å —Å —Å—Å—ã–ª–∫–∏</h3>
                <button class="modal-close" onclick="closeRemovePasswordModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="warning-icon">‚ö†Ô∏è</div>
                <p class="warning-text">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–∞—Ä–æ–ª—å —Å —ç—Ç–æ–π —Å—Å—ã–ª–∫–∏?</p>
                <div class="warning-details">
                    <p>‚Ä¢ –ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è —Å—Å—ã–ª–∫–∞ —Å—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤—Å–µ–º</p>
                    <p>‚Ä¢ –õ—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–º–æ–∂–µ—Ç –ø–µ—Ä–µ–π—Ç–∏ –ø–æ –Ω–µ–π –±–µ–∑ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è</p>
                </div>
                <div class="password-url-info">
                    <div class="password-url-label">–ö–æ—Ä–æ—Ç–∫–∞—è —Å—Å—ã–ª–∫–∞:</div>
                    <div id="password-url-short" class="password-url-value"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="cancel-button" onclick="closeRemovePasswordModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="remove-password-confirm-button" onclick="confirmRemovePassword()">–£–¥–∞–ª–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
            </div>
        </div>
    </div>

    <script>
        console.log('=== –°–∫—Ä–∏–ø—Ç –Ω–∞—á–∞–ª –∑–∞–≥—Ä—É–∑–∫—É ===');

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        let statisticsRefreshInterval = null;
        let currentStatisticsSlug = null;
        let chartInstance = null;

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        let currentStatisticsData = null;
        let currentDashboardData = null;
        let slugToDelete = null;
        let currentPasswordSlug = null;

        // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ —Å Chart.js
        function createChart(data) {
            console.log('=== –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ ===');
            console.log('–î–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞:', data);

            const container = document.getElementById('clicks-chart');
            if (!container) {
                console.error('–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }

            console.log('–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–∞–π–¥–µ–Ω:', container);

            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –≥—Ä–∞—Ñ–∏–∫
            if (chartInstance) {
                console.log('–£–Ω–∏—á—Ç–æ–∂–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –≥—Ä–∞—Ñ–∏–∫');
                chartInstance.destroy();
                chartInstance = null;
            }

            if (!data || data.length === 0) {
                console.log('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞');
                container.innerHTML = '<div class="chart-empty">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞</div>';
                return;
            }

            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ –¥–Ω—è–º
            const grouped = {};
            data.forEach(click => {
                if (click.time) {
                    const date = click.time.split(' ')[0];
                    grouped[date] = (grouped[date] || 0) + 1;
                }
            });

            console.log('–°–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', grouped);

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ
            const sortedDates = Object.keys(grouped).sort();
            const counts = sortedDates.map(date => grouped[date]);

            console.log('–û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞—Ç—ã:', sortedDates);
            console.log('–ö–æ–ª–∏—á–µ—Å—Ç–≤–∞:', counts);

            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            const formattedDates = sortedDates.map(date => {
                const [year, month, day] = date.split('-');
                return `${day}.${month}.${year}`;
            });

            console.log('–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞—Ç—ã:', formattedDates);

            // –°–æ–∑–¥–∞–µ–º canvas –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
            container.innerHTML = '<canvas id="chartCanvas" width="400" height="200"></canvas>';
            const canvas = document.getElementById('chartCanvas');
            
            if (!canvas) {
                console.error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å canvas');
                return;
            }

            const ctx = canvas.getContext('2d');
            if (!ctx) {
                console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç canvas');
                return;
            }

            console.log('Canvas —Å–æ–∑–¥–∞–Ω, —Å–æ–∑–¥–∞–µ–º –≥—Ä–∞—Ñ–∏–∫...');

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Chart.js
            if (typeof Chart === 'undefined') {
                console.error('Chart.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                container.innerHTML = '<div class="chart-empty">–û—à–∏–±–∫–∞: –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞</div>';
                return;
            }

            try {
                // –°–æ–∑–¥–∞–µ–º –≥—Ä–∞—Ñ–∏–∫
                chartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: formattedDates,
                        datasets: [{
                            label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤',
                            data: counts,
                            borderColor: '#0000FF',
                            backgroundColor: 'rgba(0, 0, 255, 0.1)',
                            tension: 0.1,
                            fill: true,
                            borderWidth: 2,
                            pointBackgroundColor: '#0000FF',
                            pointBorderColor: '#FFFFFF',
                            pointBorderWidth: 2,
                            pointRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    font: {
                                        size: 14
                                    }
                                }
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: '–î–∞—Ç–∞',
                                    font: {
                                        size: 14,
                                        weight: 'bold'
                                    }
                                },
                                ticks: {
                                    font: {
                                        size: 12
                                    }
                                }
                            },
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤',
                                    font: {
                                        size: 14,
                                        weight: 'bold'
                                    }
                                },
                                ticks: {
                                    font: {
                                        size: 12
                                    },
                                    stepSize: 1
                                }
                            }
                        }
                    }
                });

                console.log('–ì—Ä–∞—Ñ–∏–∫ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω:', chartInstance);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≥—Ä–∞—Ñ–∏–∫–∞:', error);
                container.innerHTML = '<div class="chart-empty">–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≥—Ä–∞—Ñ–∏–∫–∞</div>';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
        function displayStatisticsList(redirects) {
            const container = document.getElementById('statistics-list');
            if (!container) return;

            if (!redirects || redirects.length === 0) {
                container.innerHTML = '<div class="statistics-empty">–ü–µ—Ä–µ—Ö–æ–¥–æ–≤ –ø–æ–∫–∞ –Ω–µ –±—ã–ª–æ</div>';
                return;
            }

            let html = '';
            redirects.forEach((redirect, index) => {
                const time = redirect.time || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                const userId = redirect.created_by || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                const country = redirect.location_country || '–Ω/–¥';
                const city = redirect.location_city || '–Ω/–¥';

                // –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É –ª–æ–∫–∞—Ü–∏–∏
                let location = '';
                if (country !== '–Ω/–¥' || city !== '–Ω/–¥') {
                    if (city !== '–Ω/–¥' && country !== '–Ω/–¥') {
                        location = `${city}, ${country}`;
                    } else if (city !== '–Ω/–¥') {
                        location = city;
                    } else {
                        location = country;
                    }
                } else {
                    location = '–Ω/–¥';
                }

                html += `
                    <div class="statistics-item">
                        <div class="statistics-number">#${index + 1}</div>
                        <div class="statistics-details">
                            <div class="statistics-time">–í—Ä–µ–º—è: ${time}</div>
                            <div class="statistics-user">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${userId}</div>
                            <div class="statistics-location">–õ–æ–∫–∞—Ü–∏—è: ${location}</div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function startStatisticsAutoRefresh() {
            stopStatisticsAutoRefresh();

            statisticsRefreshInterval = setInterval(async () => {
                if (currentStatisticsSlug) {
                    await refreshStatisticsData(currentStatisticsSlug);
                }
            }, 5000);
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function stopStatisticsAutoRefresh() {
            if (statisticsRefreshInterval) {
                clearInterval(statisticsRefreshInterval);
                statisticsRefreshInterval = null;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        async function refreshStatisticsData(slug) {
            try {
                // const response = await fetch(`api/slug_redirect_history/${slug}`, {
                const response = await fetch(`/slug_redirect_history/${slug}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    currentStatisticsData = data;
                    updateStatisticsDisplay();
                } else if (response.status === 404) {
                    console.log('–ü–µ—Ä–µ—Ö–æ–¥–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç');
                } else {
                    console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', response.status);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function filterStatisticsData(data, includeMyClicks) {
            if (!data || !Array.isArray(data)) return [];

            const username = localStorage.getItem('username');
            if (includeMyClicks || !username) {
                return data;
            }

            return data.filter(redirect => redirect.created_by !== username);
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStatisticsDisplay() {
            try {
                console.log('=== –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ ===');
                
                const includeMyClicks = document.getElementById('include-my-clicks').checked;
                const filteredData = filterStatisticsData(currentStatisticsData, includeMyClicks);

                console.log('–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', filteredData);

                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
                const totalClicks = filteredData.length;
                document.getElementById('stats-total-clicks').textContent = totalClicks;

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
                displayStatisticsList(filteredData);

                // –°–æ–∑–¥–∞–µ–º –≥—Ä–∞—Ñ–∏–∫ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ DOM
                console.log('–ó–∞–ø—É—Å–∫ —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ —á–µ—Ä–µ–∑ 100ms...');
                setTimeout(() => {
                    console.log('–í—ã–∑—ã–≤–∞–µ–º createChart —Å –¥–∞–Ω–Ω—ã–º–∏:', filteredData);
                    createChart(filteredData);
                }, 100);

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤ updateStatisticsDisplay:', error);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞ "–£—á–∏—Ç—ã–≤–∞—Ç—å –º–æ–∏ –ø–µ—Ä–µ—Ö–æ–¥—ã" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function toggleMyClicks() {
            updateStatisticsDisplay();
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞ "–£—á–∏—Ç—ã–≤–∞—Ç—å –º–æ–∏ –ø–µ—Ä–µ—Ö–æ–¥—ã" –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ
        function toggleDashboardMyClicks() {
            const includeMyClicks = document.getElementById('dashboard-include-my-clicks').checked;

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É –≤ localStorage
            localStorage.setItem('includeMyClicks', includeMyClicks);

            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
            loadUserUrls(); // –ò–ª–∏ –∫–∞–∫–∞—è —É –≤–∞—Å —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Å—ã–ª–æ–∫
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function showStatisticsPage(slug, redirects) {
            console.log('=== –ü–æ–∫–∞–∑ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ ===');
            console.log('Slug:', slug);
            console.log('Redirects:', redirects);

            currentStatisticsData = redirects;
            currentStatisticsSlug = slug;
            savePageState('statistics', { slug });

            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            document.getElementById('main-page').style.display = 'none';
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('register-page').style.display = 'none';
            document.getElementById('dashboard-page').style.display = 'none';
            document.getElementById('statistics-page').style.display = 'block';

            // –ó–∞–ø–æ–ª–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Å—ã–ª–∫–µ
            const shortUrl = window.location.origin + '/' + slug;
            document.getElementById('stats-short-url').innerHTML = `<a href="${shortUrl}" target="_blank">${shortUrl}</a>`;

            let longUrl = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
            if (redirects && redirects.length > 0 && redirects[0].long_url) {
                longUrl = redirects[0].long_url;
            }
            document.getElementById('stats-long-url').textContent = longUrl;

            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è DOM
            console.log('–ó–∞–ø—É—Å–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —á–µ—Ä–µ–∑ 200ms...');
            setTimeout(() => {
                console.log('–í—ã–∑—ã–≤–∞–µ–º updateStatisticsDisplay');
                updateStatisticsDisplay();
                startStatisticsAutoRefresh();
            }, 200);
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
        async function showRedirectHistory(slug) {
            try {
                // const response = await fetch(`/api/slug_redirect_history/${slug}`, {
                const response = await fetch(`/slug_redirect_history/${slug}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    showStatisticsPage(slug, data);
                } else {
                    try {
                        const errorData = await response.json();
                        if (response.status === 404) {
                            showStatisticsPage(slug, []);
                        } else {
                            alert(`–û—à–∏–±–∫–∞: ${errorData.detail || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);
                        }
                    } catch (parseError) {
                        alert(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status}`);
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –ª–∏—á–Ω–æ–º—É –∫–∞–±–∏–Ω–µ—Ç—É
        function backToDashboard() {
            stopStatisticsAutoRefresh();
            currentStatisticsSlug = null;
            if (chartInstance) {
                chartInstance.destroy();
                chartInstance = null;
            }
            showDashboard();
            loadUrlHistory('dashboard-history-list');
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å—Å—ã–ª–∫–∏ –≤ –∏—Å—Ç–æ—Ä–∏—é
        function addUrlToHistory(newUrl, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;

            const shortUrl = window.location.origin + '/' + newUrl.slug;
            const date = new Date(newUrl.created_at).toLocaleDateString('ru-RU');

            const newItem = document.createElement('div');
            newItem.className = 'history-item';
            newItem.innerHTML = `
                <div class="history-item-original">${newUrl.long_url}</div>
                <a href="${shortUrl}" class="history-item-short" target="_blank">${shortUrl}</a>
                <div class="history-item-meta">
                    <span class="history-item-clicks">–ü–µ—Ä–µ—Ö–æ–¥–æ–≤: ${newUrl.hop_counts || 0}</span>
                    <span class="history-item-date">${date}</span>
                </div>
                <button class="details-button" onclick="showRedirectHistory('${newUrl.slug}')">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
            `;

            if (container.firstChild) {
                container.insertBefore(newItem, container.firstChild);
            } else {
                container.appendChild(newItem);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ —Å—Å—ã–ª–æ–∫
        async function loadUrlHistory(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;

            container.innerHTML = '<div class="history-loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏...</div>';

            try {
                // –ü–æ–ª—É—á–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –∑–æ–Ω—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                
                // const response = await fetch('/api/account/get_created_urls', {
                const token = localStorage.getItem('access_token');
                const response = await fetch(`/account/get_created_urls?user_tz=${encodeURIComponent(userTimezone)}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    credentials: 'include'
                });

                if (response.ok) {
                    const data = await response.json();
                    currentDashboardData = data;

                    if (data && data.length > 0) {
                        await displayUrlHistory(data, containerId);
                    } else {
                        container.innerHTML = '<div class="history-empty">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ–∫—Ä–∞—â–µ–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫</div>';
                    }
                } else {
                    container.innerHTML = '<div class="history-error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏</div>';
                }
            } catch (error) {
                container.innerHTML = '<div class="history-error">–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º</div>';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ —Å—Å—ã–ª–æ–∫
        async function displayUrlHistory(urls, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;

            const includeMyClicks = document.getElementById('dashboard-include-my-clicks').checked;
            const username = localStorage.getItem('username');

            // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
            container.innerHTML = '';

            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏, –µ—Å–ª–∏ –∏—Ö –µ—â–µ –Ω–µ—Ç
            if (!document.querySelector('#history-animation-style')) {
                const style = document.createElement('style');
                style.id = 'history-animation-style';
                style.textContent = `
            @keyframes historyItemAnimateIn {
                0% {
                    opacity: 0;
                    transform: scale(0.95);
                }

                20% {
                    opacity: 0;
                    transform: scale(0.98);
                }

                40% {
                    opacity: 1;
                    transform: scale(1.0);
                }
                60% {
                    transform: scale(1.05);
                }
                80% {
                    opacity: 1;
                    transform: scale(1.0);
                }

                100% {
                    opacity: 1;
                    transform: scale(1);
                }
            }

            .history-item-animate {
                animation: historyItemAnimateIn 1s ease forwards;
            }
        `;
                document.head.appendChild(style);
            }

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Å—Å—ã–ª–∫–∏ –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
            urls.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));

            // –í–º–µ—Å—Ç–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ HTML, —Å–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏
            for (let i = 0; i < urls.length; i++) {
                const url = urls[i];
                const shortUrl = window.location.origin + '/' + url.slug;
                const date = url.created_at ? new Date(url.created_at).toLocaleDateString('ru-RU') : '';

                let clicks = url.hop_counts || 0;

                if (!includeMyClicks && username) {
                    try {
                        const response = await fetch(`/slug_redirect_history/${url.slug}`, {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                            }
                        });

                        if (response.ok) {
                            const history = await response.json();
                            clicks = history.filter(redirect => redirect.created_by !== username).length;
                        }
                    } catch (error) {
                        console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è', url.slug);
                    }
                }

                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è
                let expirationInfo = '';
                let expirationClass = '';
                if (url.expiration_date) {
                    const expirationDate = new Date(url.expiration_date);
                    const now = new Date();
                    const isExpired = now >= expirationDate;

                    if (isExpired) {
                        expirationInfo = `<div class="expiration-status expired">‚ö†Ô∏è –ò—Å—Ç–µ–∫–ª–∞: ${expirationDate.toLocaleString('ru-RU')}</div>`;
                        expirationClass = 'expired-link';
                    } else {
                        const timeDiff = expirationDate - now;
                        const daysLeft = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                        const hoursLeft = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));

                        let timeLeftText = '';
                        if (daysLeft > 0) {
                            timeLeftText = `(–æ—Å—Ç–∞–ª–æ—Å—å ${daysLeft} –¥–Ω.)`;
                        } else if (hoursLeft > 0) {
                            timeLeftText = `(–æ—Å—Ç–∞–ª–æ—Å—å ${hoursLeft} —á.)`;
                        } else {
                            timeLeftText = '(–º–µ–Ω–µ–µ —á–∞—Å–∞)';
                        }

                        expirationInfo = `<div class="expiration-status active">‚è∞ –ò—Å—Ç–µ–∫–∞–µ—Ç: ${expirationDate.toLocaleString('ru-RU')} ${timeLeftText}</div>`;
                        expirationClass = 'expiring-link';
                    }
                } else {
                    expirationInfo = `<div class="expiration-status permanent">‚ôæÔ∏è –ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è —Å—Å—ã–ª–∫–∞</div>`;
                }

                // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç
                const historyItem = document.createElement('div');
                historyItem.className = `history-item ${expirationClass}`;

                // –°–∫—Ä—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –ø–µ—Ä–µ–¥ –∞–Ω–∏–º–∞—Ü–∏–µ–π
                historyItem.style.opacity = '0';
                historyItem.style.transform = 'scale(0.9)';

                historyItem.innerHTML = `
            <div class="history-item-original">${url.long_url || url.original_url}</div>
            <a href="${shortUrl}" class="history-item-short" target="_blank">${shortUrl}</a>
            ${expirationInfo}
            <div class="history-item-meta">
                <span class="history-item-clicks">–ü–µ—Ä–µ—Ö–æ–¥–æ–≤: ${clicks}</span>
                ${date ? `<span class="history-item-date">${date}</span>` : ''}
            </div>
            <div class="history-item-actions">
                <button class="details-button" data-slug="${url.slug}">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
                <button class="expiration-button" data-slug="${url.slug}" data-has-expiration="${url.expiration_date ? 'true' : 'false'}">
                    ${url.expiration_date ? '–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ä–æ–∫' : '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ä–æ–∫'}
                </button>
                <button class="password-button" data-slug="${url.slug}" data-has-password="${url.password ? 'true' : 'false'}">
                    ${url.password ? '–£–±—Ä–∞—Ç—å –ø–∞—Ä–æ–ª—å' : '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å'}
                </button>
                <button class="customize-slug-button" data-slug="${url.slug}" data-short-url="${shortUrl}">–ò–∑–º–µ–Ω–∏—Ç—å –∞–¥—Ä–µ—Å</button>
                <button class="delete-button" data-slug="${url.slug}" data-short-url="${shortUrl}">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
        `;

                // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                container.appendChild(historyItem);

                // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                setTimeout(() => {
                    historyItem.classList.add('history-item-animate');

                    // –£–±–∏—Ä–∞–µ–º inline —Å—Ç–∏–ª–∏ –ø–æ—Å–ª–µ –Ω–∞—á–∞–ª–∞ –∞–Ω–∏–º–∞—Ü–∏–∏
                    setTimeout(() => {
                        historyItem.style.opacity = '';
                        historyItem.style.transform = '';
                    }, 10);

                    // –£–¥–∞–ª—è–µ–º –∫–ª–∞—Å—Å –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –µ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
                    historyItem.addEventListener('animationend', () => {
                        historyItem.classList.remove('history-item-animate');
                    }, { once: true });
                }, i * 100); // –ó–∞–¥–µ—Ä–∂–∫–∞ 100ms –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            container.querySelectorAll('.details-button').forEach(button => {
                button.addEventListener('click', function() {
                    const slug = this.getAttribute('data-slug');
                    showRedirectHistory(slug);
                });
            });

            container.querySelectorAll('.expiration-button').forEach(button => {
                button.addEventListener('click', function() {
                    const slug = this.getAttribute('data-slug');
                    const hasExpiration = this.getAttribute('data-has-expiration') === 'true';

                    const urlData = urls.find(url => url.slug === slug);
                    const currentExpiration = urlData ? urlData.expiration_date : null;

                    showExpirationModal(slug, hasExpiration, currentExpiration);
                });
            });

            container.querySelectorAll('.password-button').forEach(button => {
                button.addEventListener('click', function() {
                    const slug = this.getAttribute('data-slug');
                    const hasPassword = this.getAttribute('data-has-password') === 'true';
                    if (hasPassword) {
                        showRemovePasswordModal(slug);
                    } else {
                        showSetPasswordModal(slug);
                    }
                });
            });

            container.querySelectorAll('.delete-button').forEach(button => {
                button.addEventListener('click', function() {
                    const slug = this.getAttribute('data-slug');
                    const shortUrl = this.getAttribute('data-short-url');
                    showDeleteModal(slug, shortUrl);
                });
            });

            container.querySelectorAll('.customize-slug-button').forEach(button => {
                button.addEventListener('click', function() {
                    const slug = this.getAttribute('data-slug');
                    const shortUrl = this.getAttribute('data-short-url');
                    showCustomizeSlugModal(slug, shortUrl);
                });
            });
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è —Å—Å—ã–ª–æ–∫
        async function create() {
            const url = document.getElementById('url').value;
            const resultDiv = document.getElementById('result');
            resultDiv.classList.add('ani');
            await new Promise(resolve => setTimeout(resolve, 500));
            resultDiv.innerHTML = '';
            resultDiv.classList.remove('ani-reversed');
            // const response = await fetch('/api/create_slug', {
            const response = await fetch('/create_slug', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ long_url: url })
            });

            if (!response.ok) {
                console.error('–û—à–∏–±–∫–∞:', response.status);
                return;
            }

            const data = await response.json();
            const shortUrl = window.location.origin + '/' + data.slug;

            const isAuthenticated = localStorage.getItem('isAuthenticated') === 'true';

            let resultHtml = `<div class="result-link"><a href="${shortUrl}">${shortUrl}</a></div>`;

            if (isAuthenticated && data.created_before === true) {
                resultHtml += `
                    <div class="warning-message">
                        ‚ö†Ô∏è –≠—Ç–∞ —Å—Å—ã–ª–∫–∞ —É–∂–µ —Ä–∞–Ω–µ–µ –±—ã–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞—à–∏–º —Å–µ—Ä–≤–∏—Å–æ–º. ‚ö†Ô∏è <br>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è –Ω–µ—ë –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –µ—ë —Å–æ–∑–¥–∞—Ç–µ–ª—è.
                    </div>
                `;
            }

            document.getElementById('result').innerHTML = resultHtml;

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—é –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
            const dashboardPage = document.getElementById('dashboard-page');
            if (dashboardPage && dashboardPage.style.display !== 'none') {
                const newUrl = {
                    slug: data.slug,
                    long_url: url,
                    created_at: new Date().toISOString(),
                    hop_counts: 0
                };

                addUrlToHistory(newUrl, 'dashboard-history-list');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–Ω–æ–ø–∫–∏ "–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç"
        function setupDashboardButton() {
            const loginButton = document.querySelector('.login-button');
            loginButton.textContent = '–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç';
            loginButton.onclick = function() {
                showDashboard();

                const historyContainer = document.getElementById('dashboard-history-list');
                if (historyContainer) {
                    historyContainer.innerHTML = '<div class="history-loading">–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏...</div>';
                }

                loadUrlHistory('dashboard-history-list');
            };
        }

        // –§—É–Ω–∫—Ü–∏–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        function showMainPage() {
            stopStatisticsAutoRefresh();
            stopExpirationStatusUpdate();
            currentStatisticsSlug = null;
            if (chartInstance) {
                chartInstance.destroy();
                chartInstance = null;
            }
            window.location.hash = '';

            document.getElementById('main-page').style.display = 'block';
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('register-page').style.display = 'none';
            document.getElementById('dashboard-page').style.display = 'none';
            document.getElementById('statistics-page').style.display = 'none';
            document.getElementById('email-confirmed-page').style.display = 'none';
        }

        function showLoginPage() {
            stopStatisticsAutoRefresh();
            stopExpirationStatusUpdate();
            currentStatisticsSlug = null;
            if (chartInstance) {
                chartInstance.destroy();
                chartInstance = null;
            }
            window.location.hash = '';

            document.getElementById('main-page').style.display = 'none';
            document.getElementById('login-page').style.display = 'block';
            document.getElementById('register-page').style.display = 'none';
            document.getElementById('dashboard-page').style.display = 'none';
            document.getElementById('statistics-page').style.display = 'none';
            document.getElementById('email-confirmed-page').style.display = 'none';
        }

        function showRegisterPage() {
            stopStatisticsAutoRefresh();
            currentStatisticsSlug = null;
            if (chartInstance) {
                chartInstance.destroy();
                chartInstance = null;
            }
            window.location.hash = '';

            document.getElementById('main-page').style.display = 'none';
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('register-page').style.display = 'block';
            document.getElementById('dashboard-page').style.display = 'none';
            document.getElementById('statistics-page').style.display = 'none';
        }

        function showDashboard() {
            stopStatisticsAutoRefresh();
            currentStatisticsSlug = null;
            if (chartInstance) {
                chartInstance.destroy();
                chartInstance = null;
            }
            savePageState('dashboard');

            document.getElementById('main-page').style.display = 'none';
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('register-page').style.display = 'none';
            document.getElementById('statistics-page').style.display = 'none';
            document.getElementById('dashboard-page').style.display = 'block';
            document.getElementById('forgot-password-page').style.display = 'none';
            document.getElementById('reset-password-page').style.display = 'none';
            document.getElementById('change-password-page').style.display = 'none';
            document.getElementById('email-confirmed-page').style.display = 'none';

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º email —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const userEmail = localStorage.getItem('username');
            if (userEmail) {
                document.getElementById('current-user-email').textContent = userEmail;
            }

            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è
            startExpirationStatusUpdate();

            loadUrlHistory('dashboard-history-list');
        }

        function showForgotPasswordPage() {
            stopStatisticsAutoRefresh();
            currentStatisticsSlug = null;
            if (chartInstance) {
                chartInstance.destroy();
                chartInstance = null;
            }
            window.location.hash = '';
            
            document.getElementById('main-page').style.display = 'none';
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('register-page').style.display = 'none';
            document.getElementById('dashboard-page').style.display = 'none';
            document.getElementById('statistics-page').style.display = 'none';
            document.getElementById('forgot-password-page').style.display = 'block';
            document.getElementById('reset-password-page').style.display = 'none';
            document.getElementById('change-password-page').style.display = 'none';
        }

        function showResetPasswordPage() {
            stopStatisticsAutoRefresh();
            currentStatisticsSlug = null;
            if (chartInstance) {
                chartInstance.destroy();
                chartInstance = null;
            }
            
            document.getElementById('main-page').style.display = 'none';
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('register-page').style.display = 'none';
            document.getElementById('dashboard-page').style.display = 'none';
            document.getElementById('statistics-page').style.display = 'none';
            document.getElementById('forgot-password-page').style.display = 'none';
            document.getElementById('reset-password-page').style.display = 'block';
            document.getElementById('change-password-page').style.display = 'none';
        }

        function showChangePasswordPage() {
            stopStatisticsAutoRefresh();
            currentStatisticsSlug = null;
            if (chartInstance) {
                chartInstance.destroy();
                chartInstance = null;
            }
            
            document.getElementById('main-page').style.display = 'none';
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('register-page').style.display = 'none';
            document.getElementById('dashboard-page').style.display = 'none';
            document.getElementById('statistics-page').style.display = 'none';
            document.getElementById('forgot-password-page').style.display = 'none';
            document.getElementById('reset-password-page').style.display = 'none';
            document.getElementById('email-confirmed-page').style.display = 'none';
            document.getElementById('change-password-page').style.display = 'block';
        }

        function showEmailConfirmedPage() {
            stopStatisticsAutoRefresh();
            currentStatisticsSlug = null;
            if (chartInstance) {
                chartInstance.destroy();
                chartInstance = null;
            }
            
            document.getElementById('main-page').style.display = 'none';
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('register-page').style.display = 'none';
            document.getElementById('dashboard-page').style.display = 'none';
            document.getElementById('statistics-page').style.display = 'none';
            document.getElementById('forgot-password-page').style.display = 'none';
            document.getElementById('reset-password-page').style.display = 'none';
            document.getElementById('change-password-page').style.display = 'none';
            document.getElementById('email-confirmed-page').style.display = 'block';
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏—Å—å–º–∞ –¥–ª—è —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è (–±–µ–∑ –ø–æ–∫–∞–∑–∞ —Ñ–æ—Ä–º—ã)
        async function sendPasswordResetEmail() {
            const username = localStorage.getItem('username');
            const token = localStorage.getItem('access_token');
            if (!username || !token) {
                alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
                return;
            }

            try {
                // const response = await fetch('/api/reset_password', {
                const response = await fetch('/reset_password', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ login: username })
                });

                if (response.ok) {
                    alert('–°—Å—ã–ª–∫–∞ –¥–ª—è —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ –≤–∞—à email. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ.');
                } else {
                    const errorData = await response.json().catch(() => ({}));
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è:', errorData);
                    
                    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏
                    if (response.status === 404) {
                        alert('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∞–∫–∫–∞—É–Ω—Ç —Å –¥–∞–Ω–Ω—ã–º email. –í–æ–∑–º–æ–∂–Ω–æ, –æ–Ω –±—ã–ª —É–¥–∞–ª–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–π–¥–∏—Ç–µ –∏ –≤–æ–π–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ.');
                        // –ú–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–ª–æ–≥–∏–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        logout();
                    } else {
                        alert(errorData.detail || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å—Å—ã–ª–∫–∏');
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ email —Ç–æ–∫–µ–Ω–∞
        async function validateEmailToken(token) {
            try {
                // const response = await fetch(`api/validate_email/${token}`, {
                const response = await fetch(`/validate_email/${token}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (response.ok) {
                    // –£—Å–ø–µ—à–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è email
                    showEmailConfirmedPage();
                    // –û—á–∏—â–∞–µ–º URL –æ—Ç —Ç–æ–∫–µ–Ω–∞
                    window.history.replaceState({}, document.title, window.location.pathname);
                } else {
                    const errorData = await response.json();
                    alert(errorData.detail || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ email');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ email:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è
        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const passwordIcon = document.getElementById('password-icon');

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                passwordIcon.textContent = 'üôà';
            } else {
                passwordInput.type = 'password';
                passwordIcon.textContent = 'üëÅÔ∏è';
            }
        }

        function toggleRegisterPassword() {
            const passwordInput = document.getElementById('reg-password');
            const passwordIcon = document.getElementById('reg-password-icon');

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                passwordIcon.textContent = 'üôà';
            } else {
                passwordInput.type = 'password';
                passwordIcon.textContent = 'üëÅÔ∏è';
            }
        }

        function toggleRegisterPasswordConfirm() {
            const passwordInput = document.getElementById('reg-password-confirm');
            const passwordIcon = document.getElementById('reg-password-confirm-icon');

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                passwordIcon.textContent = 'üôà';
            } else {
                passwordInput.type = 'password';
                passwordIcon.textContent = 'üëÅÔ∏è';
            }
        }

        function toggleNewPassword() {
            const passwordInput = document.getElementById('new-password');
            const passwordIcon = document.getElementById('new-password-icon');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                passwordIcon.textContent = 'üôà';
            } else {
                passwordInput.type = 'password';
                passwordIcon.textContent = 'üëÅÔ∏è';
            }
        }

        function toggleNewPasswordConfirm() {
            const passwordInput = document.getElementById('new-password-confirm');
            const passwordIcon = document.getElementById('new-password-confirm-icon');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                passwordIcon.textContent = 'üôà';
            } else {
                passwordInput.type = 'password';
                passwordIcon.textContent = 'üëÅÔ∏è';
            }
        }

        function toggleChangeNewPassword() {
            const passwordInput = document.getElementById('change-new-password');
            const passwordIcon = document.getElementById('change-new-password-icon');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                passwordIcon.textContent = 'üôà';
            } else {
                passwordInput.type = 'password';
                passwordIcon.textContent = 'üëÅÔ∏è';
            }
        }

        function toggleChangeNewPasswordConfirm() {
            const passwordInput = document.getElementById('change-new-password-confirm');
            const passwordIcon = document.getElementById('change-new-password-confirm-icon');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                passwordIcon.textContent = 'üôà';
            } else {
                passwordInput.type = 'password';
                passwordIcon.textContent = 'üëÅÔ∏è';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ email —Å –∫–Ω–æ–ø–∫–æ–π –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
        function showEmailValidationError(email, message) {
            const errorHtml = `
                <div style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 20px; margin: 20px 0;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <span style="font-size: 24px;">‚ö†Ô∏è</span>
                        <h4 style="margin: 0; color: #856404;">–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email</h4>
                    </div>
                    <p style="margin: 10px 0; color: #856404;">${message}</p>
                    <p style="margin: 10px 0; color: #856404;">–ù–µ –ø–æ–ª—É—á–∏–ª–∏ –ø–∏—Å—å–º–æ? –ú—ã –º–æ–∂–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –µ–≥–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ.</p>
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button onclick="resendValidationEmail('${email}')" style="
                            background-color: #ffc107; 
                            color: #212529; 
                            border: none; 
                            padding: 10px 20px; 
                            border-radius: 5px; 
                            cursor: pointer;
                            font-weight: 500;
                        ">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ</button>
                        <button onclick="closeEmailValidationError()" style="
                            background-color: #6c757d; 
                            color: white; 
                            border: none; 
                            padding: 10px 20px; 
                            border-radius: 5px; 
                            cursor: pointer;
                        ">–ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                </div>
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞
            const loginForm = document.getElementById('loginForm');
            const existingError = document.getElementById('email-validation-error');
            if (existingError) {
                existingError.remove();
            }
            
            const errorDiv = document.createElement('div');
            errorDiv.id = 'email-validation-error';
            errorDiv.innerHTML = errorHtml;
            loginForm.parentNode.insertBefore(errorDiv, loginForm.nextSibling);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ email
        function closeEmailValidationError() {
            const errorDiv = document.getElementById('email-validation-error');
            if (errorDiv) {
                errorDiv.remove();
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏—Å—å–º–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
        async function resendValidationEmail(email) {
            try {
                // const response = await fetch('/api/validate_email', {
                const response = await fetch('/validate_email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ login: email })
                });
                
                if (response.ok) {
                    alert('–ü–∏—Å—å–º–æ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à—É —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –ø–æ—á—Ç—É.');
                    closeEmailValidationError();
                    closeRegistrationMessage();
                } else {
                    const errorData = await response.json().catch(() => ({}));
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø–∏—Å—å–º–∞: ' + (errorData.detail || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        function showRegistrationSuccess(email) {
            const successHtml = `
                <div style="background: #d4edda; border: 1px solid #c3e6cb; border-radius: 8px; padding: 20px; margin: 20px 0;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <span style="font-size: 24px;">‚úÖ</span>
                        <h4 style="margin: 0; color: #155724;">–ê–∫–∫–∞—É–Ω—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!</h4>
                    </div>
                    <p style="margin: 10px 0; color: #155724;">–ü–∏—Å—å–º–æ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ <strong>${email}</strong></p>
                    <p style="margin: 10px 0; color: #155724;">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à—É —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –ø–æ—á—Ç—É –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞.</p>
                    <button onclick="closeRegistrationMessage(); showLoginPage();" style="
                        background-color: #28a745; 
                        color: white; 
                        border: none; 
                        padding: 10px 20px; 
                        border-radius: 5px; 
                        cursor: pointer;
                        font-weight: 500;
                    ">–ü–µ—Ä–µ–π—Ç–∏ –∫ –≤—Ö–æ–¥—É</button>
                </div>
            `;
            
            showRegistrationMessage(successHtml);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å –∫–Ω–æ–ø–∫–æ–π –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
        function showRegistrationSuccessWithResend(email, message) {
            const successHtml = `
                <div style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 20px; margin: 20px 0;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <span style="font-size: 24px;">‚ö†Ô∏è</span>
                        <h4 style="margin: 0; color: #856404;">–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω</h4>
                    </div>
                    <p style="margin: 10px 0; color: #856404;">${message}</p>
                    <p style="margin: 10px 0; color: #856404;">–í—ã –º–æ–∂–µ—Ç–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω–æ.</p>
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button onclick="resendValidationEmail('${email}')" style="
                            background-color: #ffc107; 
                            color: #212529; 
                            border: none; 
                            padding: 10px 20px; 
                            border-radius: 5px; 
                            cursor: pointer;
                            font-weight: 500;
                        ">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ</button>
                        <button onclick="closeRegistrationMessage(); showLoginPage();" style="
                            background-color: #6c757d; 
                            color: white; 
                            border: none; 
                            padding: 10px 20px; 
                            border-radius: 5px; 
                            cursor: pointer;
                        ">–ü–µ—Ä–µ–π—Ç–∏ –∫ –≤—Ö–æ–¥—É</button>
                    </div>
                </div>
            `;
            
            showRegistrationMessage(successHtml);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        function showRegistrationMessage(html) {
            const registerForm = document.getElementById('registerForm');
            const existingMessage = document.getElementById('registration-message');
            if (existingMessage) {
                existingMessage.remove();
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.id = 'registration-message';
            messageDiv.innerHTML = html;
            registerForm.parentNode.insertBefore(messageDiv, registerForm.nextSibling);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        function closeRegistrationMessage() {
            const messageDiv = document.getElementById('registration-message');
            if (messageDiv) {
                messageDiv.remove();
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞
        function showAccountCreatedMessage(email) {
            const successHtml = `
                <div style="background: #d4edda; border: 1px solid #c3e6cb; border-radius: 8px; padding: 20px; margin: 20px 0;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <span style="font-size: 24px;">‚úÖ</span>
                        <h4 style="margin: 0; color: #155724;">–ê–∫–∫–∞—É–Ω—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!</h4>
                    </div>
                    <p style="margin: 10px 0; color: #155724;">–ü–∏—Å—å–º–æ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø–∞–ø–∫—É "–°–ø–∞–º". –ï—Å–ª–∏ –í—ã –Ω–µ –ø–æ–ª—É—á–∏–ª–∏ –ø–∏—Å—å–º–æ, –∑–∞–ø—Ä–æ—Å–∏—Ç–µ –µ–≥–æ –∑–∞–Ω–æ–≤–æ.</p>
                    <button onclick="closeRegistrationMessage(); showLoginPage();" style="
                        background-color: #28a745; 
                        color: white; 
                        border: none; 
                        padding: 10px 20px; 
                        border-radius: 5px; 
                        cursor: pointer;
                        font-weight: 500;
                    ">–ü–µ—Ä–µ–π—Ç–∏ –∫ –≤—Ö–æ–¥—É</button>
                </div>
            `;
            
            showRegistrationMessage(successHtml);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞ —Å –∫–Ω–æ–ø–∫–æ–π –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
        function updateAccountCreatedMessageWithResend(email) {
            const warningHtml = `
                <div style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 20px; margin: 20px 0;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <span style="font-size: 24px;">‚ö†Ô∏è</span>
                        <h4 style="margin: 0; color: #856404;">–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω</h4>
                    </div>
                    <p style="margin: 10px 0; color: #856404;">–ü–∏—Å—å–º–æ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø–∞–ø–∫—É "–°–ø–∞–º". –ï—Å–ª–∏ –í—ã –Ω–µ –ø–æ–ª—É—á–∏–ª–∏ –ø–∏—Å—å–º–æ, –∑–∞–ø—Ä–æ—Å–∏—Ç–µ –µ–≥–æ –∑–∞–Ω–æ–≤–æ.</p>
                    <p style="margin: 10px 0; color: #856404;">–ï—Å–ª–∏ –ø–∏—Å—å–º–æ –Ω–µ –ø—Ä–∏—à–ª–æ, –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–ø—Ä–æ—Å–∏—Ç—å –µ–≥–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ.</p>
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button onclick="resendValidationEmail('${email}')" style="
                            background-color: #ffc107; 
                            color: #212529; 
                            border: none; 
                            padding: 10px 20px; 
                            border-radius: 5px; 
                            cursor: pointer;
                            font-weight: 500;
                        ">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ</button>
                        <button onclick="closeRegistrationMessage(); showLoginPage();" style="
                            background-color: #6c757d; 
                            color: white; 
                            border: none; 
                            padding: 10px 20px; 
                            border-radius: 5px; 
                            cursor: pointer;
                        ">–ü–µ—Ä–µ–π—Ç–∏ –∫ –≤—Ö–æ–¥—É</button>
                    </div>
                </div>
            `;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            const existingMessage = document.getElementById('registration-message');
            if (existingMessage) {
                existingMessage.innerHTML = warningHtml;
            } else {
                showRegistrationMessage(warningHtml);
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        document.addEventListener('DOMContentLoaded', function() {
            // –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞
            document.getElementById('loginForm').addEventListener('submit', async function(e) {
                e.preventDefault();

                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                if (!username || !password) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                    return;
                }

                try {
                    const requestData = {
                        login: username,
                        password: password
                    };

                    // const response = await fetch('/api/auth/login', {
                    const response = await fetch('/auth/login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(requestData)
                    });

                    if (response.ok) {
                        const data = await response.json();

                        localStorage.setItem('access_token', data.access_token);
                        localStorage.setItem('isAuthenticated', 'true');
                        localStorage.setItem('username', username);

                        setupDashboardButton();
                        showDashboard();

                        document.getElementById('username').value = '';
                        document.getElementById('password').value = '';

                    } else {
                        const errorText = await response.text();
                        try {
                            const errorData = JSON.parse(errorText);
                            const errorMessage = errorData.message || errorData.detail || '–ù–µ–≤–µ—Ä–Ω—ã–π –∞–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã –∏–ª–∏ –ø–∞—Ä–æ–ª—å';
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å–ª–∏ –æ—à–∏–±–∫–∞ —Å–≤—è–∑–∞–Ω–∞ —Å –Ω–µ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω–æ–π –ø–æ—á—Ç–æ–π
                            if (errorMessage.includes('–ü–æ—á—Ç–∞ –Ω–µ –±—ã–ª–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞')) {
                                showEmailValidationError(username, errorMessage);
                            } else {
                                alert(errorMessage);
                            }
                        } catch (e) {
                            alert('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ' + errorText);
                        }
                    }
                } catch (error) {
                    alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
                }
            });

            // –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            document.getElementById('registerForm').addEventListener('submit', async function(e) {
                e.preventDefault();

                const username = document.getElementById('reg-username').value;
                const password = document.getElementById('reg-password').value;
                const passwordConfirm = document.getElementById('reg-password-confirm').value;

                if (!username || !password || !passwordConfirm) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                    return;
                }

                if (password !== passwordConfirm) {
                    alert('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
                    return;
                }

                try {
                    const requestData = {
                        login: username,
                        password: password
                    };

                    // const response = await fetch('/api/auth/create_account', {
                    const response = await fetch('/auth/create_account', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(requestData)
                    });

                    if (response.ok) {
                        const data = await response.json();
                        
                        // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                        document.getElementById('reg-username').value = '';
                        document.getElementById('reg-password').value = '';
                        document.getElementById('reg-password-confirm').value = '';
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø–∏—Å—å–º–∞
                        showAccountCreatedMessage(username);
                        
                        // –ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email –≤ —Ñ–æ–Ω–µ
                        try {
                            // const validateResponse = await fetch('/api/validate_email', {
                            const validateResponse = await fetch('/validate_email', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({ login: username })
                            });
                            
                            if (!validateResponse.ok) {
                                console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è');
                                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ, –¥–æ–±–∞–≤–ª—è—è –∫–Ω–æ–ø–∫—É –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
                                updateAccountCreatedMessageWithResend(username);
                            }
                        } catch (emailError) {
                            console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø–∏—Å—å–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:', emailError);
                            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ, –¥–æ–±–∞–≤–ª—è—è –∫–Ω–æ–ø–∫—É –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
                            updateAccountCreatedMessageWithResend(username);
                        }

                    } else {
                        const errorText = await response.text();
                        try {
                            const errorData = JSON.parse(errorText);
                            alert(errorData.message || errorData.detail || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞');
                        } catch (e) {
                            alert('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ' + errorText);
                        }
                    }
                } catch (error) {
                    alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
                }
            });

            // –§–æ—Ä–º–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è
            document.getElementById('forgotPasswordForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const email = document.getElementById('forgot-email').value;
                
                if (!email) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ email');
                    return;
                }

                try {
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞ –∫–∞–∫ JSON
                    // const response = await fetch('/api/reset_password', {
                    const response = await fetch('/reset_password', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ login: email })
                    });

                    if (response.ok) {
                        alert('–°—Å—ã–ª–∫–∞ –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ –≤–∞—à email');
                        // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ
                        const form = document.getElementById('forgotPasswordForm');
                        form.reset();
                        document.getElementById('forgot-email').value = '';
                        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –±—Ä–∞—É–∑–µ—Ä–æ–º
                        setTimeout(() => {
                            form.reset();
                        }, 100);
                        showLoginPage();
                    } else {
                        const errorData = await response.json().catch(() => ({}));
                        console.error('–û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è:', errorData);
                        
                        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏
                        if (response.status === 404) {
                            alert('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∞–∫–∫–∞—É–Ω—Ç —Å –¥–∞–Ω–Ω—ã–º email. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –≤–≤–µ–¥–µ–Ω–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∞–∫–∫–∞—É–Ω—Ç.');
                        } else {
                            alert(errorData.detail || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å—Å—ã–ª–∫–∏');
                        }
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:', error);
                    alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
                }
            });

            // –§–æ—Ä–º–∞ —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
            document.getElementById('resetPasswordForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const newPassword = document.getElementById('new-password').value;
                const confirmPassword = document.getElementById('new-password-confirm').value;
                
                if (!newPassword || !confirmPassword) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                    return;
                }

                if (newPassword !== confirmPassword) {
                    alert('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
                    return;
                }

                // –ü–æ–ª—É—á–∞–µ–º token –∏–∑ URL
                const urlParams = new URLSearchParams(window.location.search);
                const token = urlParams.get('token');
                
                if (!token) {
                    alert('–¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ URL');
                    return;
                }

                try {
                    // const response = await fetch(`/api/reset_password/${token}?new_password=${encodeURIComponent(newPassword)}`, {
                    const response = await fetch(`/reset_password/${token}?new_password=${encodeURIComponent(newPassword)}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    });

                    if (response.ok) {
                        const result = await response.json();
                        alert(result.message || '–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω! –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏ —Å –Ω–æ–≤—ã–º –ø–∞—Ä–æ–ª–µ–º.');
                        // –û—á–∏—â–∞–µ–º URL –æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
                        window.history.replaceState({}, document.title, window.location.pathname);
                        showLoginPage();
                    } else {
                        const errorData = await response.json();
                        console.error('–û—à–∏–±–∫–∞ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è:', errorData);
                        alert(errorData.detail || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ –ø–∞—Ä–æ–ª—è');
                    }
                } catch (error) {
                    alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
                }
            });

            // –§–æ—Ä–º–∞ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            document.getElementById('changePasswordForm').addEventListener('submit', async function(e) {
                e.preventDefault();

                const newPassword = document.getElementById('change-new-password').value;
                const confirmPassword = document.getElementById('change-new-password-confirm').value;

                if (!newPassword || !confirmPassword) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                    return;
                }

                if (newPassword !== confirmPassword) {
                    alert('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
                    return;
                }

                const username = localStorage.getItem('username');
                if (!username) {
                    alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
                    return;
                }

                try {
                    // –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è —Å–±—Ä–æ—Å–∞
                    // const response = await fetch('/api/reset_password', {
                    const response = await fetch('/reset_password', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ login: username })
                    });

                    if (response.ok) {
                        alert('–°—Å—ã–ª–∫–∞ –¥–ª—è —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ –≤–∞—à email. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ.');
                        // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ
                        const form = document.getElementById('changePasswordForm');
                        form.reset();
                        document.getElementById('change-new-password').value = '';
                        document.getElementById('change-new-password-confirm').value = '';
                        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –±—Ä–∞—É–∑–µ—Ä–æ–º
                        setTimeout(() => {
                            form.reset();
                        }, 100);
                        showDashboard();
                    } else {
                        const errorData = await response.json().catch(() => ({}));
                        console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è:', errorData);
                        
                        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏
                        if (response.status === 404) {
                            alert('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∞–∫–∫–∞—É–Ω—Ç —Å –¥–∞–Ω–Ω—ã–º email. –í–æ–∑–º–æ–∂–Ω–æ, –æ–Ω –±—ã–ª —É–¥–∞–ª–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–π–¥–∏—Ç–µ –∏ –≤–æ–π–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ.');
                            // –ú–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–ª–æ–≥–∏–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                            logout();
                        } else {
                            alert(errorData.detail || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å—Å—ã–ª–∫–∏');
                        }
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:', error);
                    alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
                }
            });
        });

        // –§—É–Ω–∫—Ü–∏—è –≤—ã—Ö–æ–¥–∞
        async function logout() {
            try {
                // await fetch('/api/logout', {
                await fetch('/logout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
            } catch (error) {
                console.log('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ:', error);
            }

            localStorage.removeItem('isAuthenticated');
            localStorage.removeItem('username');

            const loginButton = document.querySelector('.login-button');
            loginButton.textContent = '–í–æ–π—Ç–∏';
            loginButton.onclick = showLoginPage;

            showMainPage();
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è
        function showDeleteModal(slug, shortUrl) {
            slugToDelete = slug;
            document.getElementById('delete-url-short').textContent = shortUrl;
            document.getElementById('delete-modal').style.display = 'flex';
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è
        function closeDeleteModal() {
            slugToDelete = null;
            document.getElementById('delete-modal').style.display = 'none';
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è
        async function confirmDelete() {
            if (!slugToDelete) {
                console.error('–ù–µ—Ç slug –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è');
                return;
            }

            try {
                // const response = await fetch(`/api/delete_slug/${slugToDelete}`, {
                const token = localStorage.getItem('access_token');
                const response = await fetch(`/delete_slug/${slugToDelete}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    credentials: 'include'
                });

                if (response.ok) {
                    closeDeleteModal();
                    await loadUrlHistory('dashboard-history-list');
                    alert('–°—Å—ã–ª–∫–∞ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞');
                } else {
                    const errorData = await response.json().catch(() => ({}));
                    const errorMessage = errorData.detail || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
                    alert(`–û—à–∏–±–∫–∞: ${errorMessage}`);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–µ–º –∏—Å—Ç–µ—á–µ–Ω–∏—è
        let currentExpirationSlug = null;
        let expirationUpdateInterval = null;

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è
        function startExpirationStatusUpdate() {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            expirationUpdateInterval = setInterval(() => {
                updateExpirationStatuses();
            }, 30000);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        function stopExpirationStatusUpdate() {
            if (expirationUpdateInterval) {
                clearInterval(expirationUpdateInterval);
                expirationUpdateInterval = null;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ –∏—Å—Ç–µ—á–µ–Ω–∏—è –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
        function updateExpirationStatuses() {
            const expirationElements = document.querySelectorAll('.expiration-status.active');
            const now = new Date();
            
            expirationElements.forEach(element => {
                const text = element.textContent;
                const dateMatch = text.match(/(\d{2}\.\d{2}\.\d{4}, \d{2}:\d{2}:\d{2})/);
                
                if (dateMatch) {
                    const dateStr = dateMatch[1];
                    const [datePart, timePart] = dateStr.split(', ');
                    const [day, month, year] = datePart.split('.');
                    const [hour, minute, second] = timePart.split(':');
                    
                    const expirationDate = new Date(year, month - 1, day, hour, minute, second);
                    
                    if (now >= expirationDate) {
                        // –°—Å—ã–ª–∫–∞ –∏—Å—Ç–µ–∫–ª–∞, –æ–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                        element.className = 'expiration-status expired';
                        element.innerHTML = `‚ö†Ô∏è –ò—Å—Ç–µ–∫–ª–∞: ${expirationDate.toLocaleString('ru-RU')}`;
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–ª–∞—Å—Å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        const historyItem = element.closest('.history-item');
                        if (historyItem) {
                            historyItem.classList.remove('expiring-link');
                            historyItem.classList.add('expired-link');
                        }
                    } else {
                        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è
                        const timeDiff = expirationDate - now;
                        const daysLeft = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                        const hoursLeft = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        
                        let timeLeftText = '';
                        if (daysLeft > 0) {
                            timeLeftText = `(–æ—Å—Ç–∞–ª–æ—Å—å ${daysLeft} –¥–Ω.)`;
                        } else if (hoursLeft > 0) {
                            timeLeftText = `(–æ—Å—Ç–∞–ª–æ—Å—å ${hoursLeft} —á.)`;
                        } else {
                            timeLeftText = '(–º–µ–Ω–µ–µ —á–∞—Å–∞)';
                        }
                        
                        element.innerHTML = `‚è∞ –ò—Å—Ç–µ–∫–∞–µ—Ç: ${expirationDate.toLocaleString('ru-RU')} ${timeLeftText}`;
                    }
                }
            });
        }

        // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–µ–º –∏—Å—Ç–µ—á–µ–Ω–∏—è
        function showExpirationModal(slug, hasExpiration, currentExpiration = null) {
            currentExpirationSlug = slug;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è —Å—Ä–æ–∫–∞
            const removeBtn = document.getElementById('remove-exp-btn');
            const currentInfo = document.getElementById('current-expiration-info');
            const currentText = document.getElementById('current-expiration-text');
            
            if (hasExpiration && currentExpiration) {
                removeBtn.style.display = 'inline-block';
                currentInfo.style.display = 'block';
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–µ–∫—É—â–∏–π —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
                const expDate = new Date(currentExpiration);
                currentText.textContent = `–¢–µ–∫—É—â–∏–π —Å—Ä–æ–∫: ${expDate.toLocaleString('ru-RU')}`;
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è —Ç–µ–∫—É—â–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
                document.getElementById('exp-day').value = expDate.getDate();
                document.getElementById('exp-month').value = expDate.getMonth() + 1;
                document.getElementById('exp-year').value = expDate.getFullYear();
                document.getElementById('exp-hour').value = expDate.getHours();
                document.getElementById('exp-minute').value = expDate.getMinutes();
            } else {
                removeBtn.style.display = 'none';
                currentInfo.style.display = 'none';
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–∑–∞–≤—Ç—Ä–∞ –≤ 12:00)
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                tomorrow.setHours(12, 0, 0, 0);
                
                document.getElementById('exp-day').value = tomorrow.getDate();
                document.getElementById('exp-month').value = tomorrow.getMonth() + 1;
                document.getElementById('exp-year').value = tomorrow.getFullYear();
                document.getElementById('exp-hour').value = 12;
                document.getElementById('exp-minute').value = 0;
            }
            
            document.getElementById('expiration-modal').style.display = 'flex';
        }

        function closeExpirationModal() {
            currentExpirationSlug = null;
            document.getElementById('expiration-modal').style.display = 'none';
        }

        function setQuickExpiration(days) {
            const date = new Date();
            date.setDate(date.getDate() + days);
            date.setHours(12, 0, 0, 0);
            
            document.getElementById('exp-day').value = date.getDate();
            document.getElementById('exp-month').value = date.getMonth() + 1;
            document.getElementById('exp-year').value = date.getFullYear();
            document.getElementById('exp-hour').value = 12;
            document.getElementById('exp-minute').value = 0;
        }

        // –§—É–Ω–∫—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ–ª–µ–π –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
        function validateDateTimeInputs() {
            const day = parseInt(document.getElementById('exp-day').value);
            const month = parseInt(document.getElementById('exp-month').value);
            const year = parseInt(document.getElementById('exp-year').value);
            const hour = parseInt(document.getElementById('exp-hour').value);
            const minute = parseInt(document.getElementById('exp-minute').value);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å –ø–æ–ª–µ–π
            if (!day || !month || !year || hour === undefined || minute === undefined) {
                return { valid: false, message: '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è' };
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω—ã –∑–Ω–∞—á–µ–Ω–∏–π
            if (day < 1 || day > 31) {
                return { valid: false, message: '–î–µ–Ω—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 1 –¥–æ 31' };
            }
            
            if (month < 1 || month > 12) {
                return { valid: false, message: '–ú–µ—Å—è—Ü –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 1 –¥–æ 12' };
            }
            
            if (year < 2024) {
                return { valid: false, message: '–ì–æ–¥ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ 2024' };
            }
            
            if (hour < 0 || hour > 23) {
                return { valid: false, message: '–ß–∞—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 0 –¥–æ 23' };
            }
            
            if (minute < 0 || minute > 59) {
                return { valid: false, message: '–ú–∏–Ω—É—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 0 –¥–æ 59' };
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –¥–∞—Ç—ã
            const testDate = new Date(year, month - 1, day, hour, minute);
            if (testDate.getDate() !== day || testDate.getMonth() !== month - 1 || testDate.getFullYear() !== year) {
                return { valid: false, message: '–£–∫–∞–∑–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç' };
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞—Ç–∞ –≤ –±—É–¥—É—â–µ–º
            const now = new Date();
            if (testDate <= now) {
                return { valid: false, message: '–î–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ –±—É–¥—É—â–µ–º' };
            }
            
            return { valid: true, date: testDate };
        }

        async function setExpiration() {
            if (!currentExpirationSlug) return;
            
            // –í–∞–ª–∏–¥–∏—Ä—É–µ–º –≤–≤–µ–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            const validation = validateDateTimeInputs();
            if (!validation.valid) {
                alert(validation.message);
                return;
            }
            
            const expirationDate = validation.date;
            const day = expirationDate.getDate();
            const month = expirationDate.getMonth() + 1;
            const year = expirationDate.getFullYear();
            const hour = expirationDate.getHours();
            const minute = expirationDate.getMinutes();

            // –ü–æ–ª—É—á–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –∑–æ–Ω—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            console.log('–û–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è –∑–æ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', userTimezone);
            
            try {
                const token = localStorage.getItem('access_token');
                const response = await fetch(`/set_expiration_date/${currentExpirationSlug}?user_tz=${encodeURIComponent(userTimezone)}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        year: year,
                        month: month,
                        day: day,
                        hour: hour,
                        minute: minute
                    })
                });

                if (response.ok) {
                    closeExpirationModal();
                    await loadUrlHistory('dashboard-history-list');
                    showNotification('–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Å—Å—ã–ª–∫–∏ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω', 'success');
                } else {
                    const errorData = await response.json().catch(() => ({}));
                    showNotification(errorData.detail || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è', 'error');
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }

        async function removeExpiration() {
            if (!currentExpirationSlug) return;
            
            try {
                const token = localStorage.getItem('access_token');
                const response = await fetch(`/remove_expiration_date/${currentExpirationSlug}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    credentials: 'include'
                });

                if (response.ok) {
                    closeExpirationModal();
                    await loadUrlHistory('dashboard-history-list');
                    showNotification('–°—Å—ã–ª–∫–∞ —Å–¥–µ–ª–∞–Ω–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π', 'success');
                } else {
                    const errorData = await response.json().catch(() => ({}));
                    showNotification(errorData.detail || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è', 'error');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        function showNotification(message, type = 'info') {
            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.textContent = message;
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 12px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 500;
                z-index: 10000;
                max-width: 300px;
                word-wrap: break-word;
                transition: all 0.3s ease;
            `;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
            switch (type) {
                case 'success':
                    notification.style.backgroundColor = '#28a745';
                    break;
                case 'error':
                    notification.style.backgroundColor = '#dc3545';
                    break;
                case 'warning':
                    notification.style.backgroundColor = '#ffc107';
                    notification.style.color = '#212529';
                    break;
                default:
                    notification.style.backgroundColor = '#17a2b8';
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
            document.body.appendChild(notification);
            
            // –£–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º slug'–∞
        let currentSlugToCustomize = null;
        let currentShortUrl = null;

        // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º slug'–∞
        function showCustomizeSlugModal(slug, shortUrl) {
            currentSlugToCustomize = slug;
            currentShortUrl = shortUrl;
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π –∞–¥—Ä–µ—Å
            const domain = window.location.origin + '/';
            document.getElementById('current-domain').textContent = domain;
            document.getElementById('current-slug-display').textContent = slug;
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ –¥–ª—è –Ω–æ–≤–æ–≥–æ –∞–¥—Ä–µ—Å–∞
            document.getElementById('new-domain').textContent = domain;
            document.getElementById('new-slug-input').value = slug;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
            updateSlugPreview();
            
            document.getElementById('customize-slug-modal').style.display = 'flex';
        }

        function closeCustomizeSlugModal() {
            currentSlugToCustomize = null;
            currentShortUrl = null;
            document.getElementById('customize-slug-modal').style.display = 'none';
            document.getElementById('new-slug-input').value = '';
            document.getElementById('slug-preview').style.display = 'none';
        }

        function updateSlugPreview() {
            const newSlug = document.getElementById('new-slug-input').value.trim();
            const previewContainer = document.getElementById('slug-preview');
            const previewUrl = document.getElementById('preview-url');
            
            if (newSlug && newSlug !== currentSlugToCustomize) {
                const domain = window.location.origin + '/';
                previewUrl.textContent = domain + newSlug;
                previewContainer.style.display = 'block';
            } else {
                previewContainer.style.display = 'none';
            }
        }

        async function customizeSlug() {
            if (!currentSlugToCustomize) return;
            
            const newSlug = document.getElementById('new-slug-input').value.trim();
            
            // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
            if (!newSlug) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –∞–¥—Ä–µ—Å —Å—Å—ã–ª–∫–∏', 'error');
                return;
            }
            
            if (newSlug === currentSlugToCustomize) {
                showNotification('–ù–æ–≤—ã–π –∞–¥—Ä–µ—Å –¥–æ–ª–∂–µ–Ω –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ', 'warning');
                return;
            }
            
            try {
                const token = localStorage.getItem('access_token');
                const response = await fetch(`/account/customize_slug/${currentSlugToCustomize}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ new_slug: newSlug }),
                    credentials: 'include'
                });

                if (response.ok) {
                    closeCustomizeSlugModal();
                    await loadUrlHistory('dashboard-history-list');
                    showNotification('–ê–¥—Ä–µ—Å —Å—Å—ã–ª–∫–∏ —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω', 'success');
                } else {
                    const errorData = await response.json().catch(() => ({}));
                    if (response.status === 409) {
                        showNotification('–≠—Ç–æ—Ç –∞–¥—Ä–µ—Å —É–∂–µ –∑–∞–Ω—è—Ç. –í—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–π.', 'error');
                    } else {
                        showNotification(errorData.detail || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∞–¥—Ä–µ—Å–∞ —Å—Å—ã–ª–∫–∏', 'error');
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ slug:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        document.addEventListener('click', function(event) {
            const deleteModal = document.getElementById('delete-modal');
            const expirationModal = document.getElementById('expiration-modal');
            const customizeSlugModal = document.getElementById('customize-slug-modal');
            const setPasswordModal = document.getElementById('set-password-modal');
            const removePasswordModal = document.getElementById('remove-password-modal');
            
            if (event.target === deleteModal) {
                closeDeleteModal();
            }
            
            if (event.target === expirationModal) {
                closeExpirationModal();
            }
            
            if (event.target === customizeSlugModal) {
                closeCustomizeSlugModal();
            }
            
            if (event.target === setPasswordModal) {
                closeSetPasswordModal();
            }
            
            if (event.target === removePasswordModal) {
                closeRemovePasswordModal();
            }
        });

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∞–≤—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
        document.addEventListener('DOMContentLoaded', function() {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–ª–µ–π –¥–∞—Ç—ã
            document.getElementById('exp-day').addEventListener('input', function() {
                let value = parseInt(this.value);
                if (value > 31) this.value = 31;
                if (value < 1 && this.value !== '') this.value = 1;
            });
            
            document.getElementById('exp-month').addEventListener('input', function() {
                let value = parseInt(this.value);
                if (value > 12) this.value = 12;
                if (value < 1 && this.value !== '') this.value = 1;
            });
            
            document.getElementById('exp-year').addEventListener('input', function() {
                let value = parseInt(this.value);
                if (value < 2024 && this.value !== '') this.value = 2024;
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–ª–µ–π –≤—Ä–µ–º–µ–Ω–∏
            document.getElementById('exp-hour').addEventListener('input', function() {
                let value = parseInt(this.value);
                if (value > 23) this.value = 23;
                if (value < 0 && this.value !== '') this.value = 0;
            });
            
            document.getElementById('exp-minute').addEventListener('input', function() {
                let value = parseInt(this.value);
                if (value > 59) this.value = 59;
                if (value < 0 && this.value !== '') this.value = 0;
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–æ–ª—è –≤–≤–æ–¥–∞ –Ω–æ–≤–æ–≥–æ slug'–∞
            document.getElementById('new-slug-input').addEventListener('input', function() {
                updateSlugPreview();
            });
        });

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', function() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ç–æ–∫–µ–Ω—ã –≤ URL
            const urlParams = new URLSearchParams(window.location.search);
            const resetToken = urlParams.get('token');
            const validateToken = urlParams.get('validate_token');
            
            if (validateToken) {
                // –¢–æ–∫–µ–Ω –≤–∞–ª–∏–¥–∞—Ü–∏–∏ email
                console.log('–ù–∞–π–¥–µ–Ω —Ç–æ–∫–µ–Ω –≤–∞–ª–∏–¥–∞—Ü–∏–∏ email:', validateToken);
                validateEmailToken(validateToken);
                return;
            }
            
            if (resetToken) {
                // –¢–æ–∫–µ–Ω —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
                console.log('–ù–∞–π–¥–µ–Ω —Ç–æ–∫–µ–Ω —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è:', resetToken);
                showResetPasswordPage();
                return;
            }
            
            const isAuthenticated = localStorage.getItem('isAuthenticated');
            const loginButton = document.querySelector('.login-button');

            if (isAuthenticated === 'true') {
                setupDashboardButton();

                const pageState = loadPageState();
                if (pageState) {
                    if (pageState.page === 'statistics' && pageState.slug) {
                        showRedirectHistory(pageState.slug);
                    } else if (pageState.page === 'dashboard') {
                        showDashboard();
                    }
                }
            } else {
                loginButton.textContent = '–í–æ–π—Ç–∏';
                loginButton.onclick = showLoginPage;
            }
        });

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function savePageState(page, data = {}) {
            const state = { page, ...data };
            window.location.hash = encodeURIComponent(JSON.stringify(state));
        }

        function loadPageState() {
            const hash = window.location.hash.substring(1);
            if (hash) {
                try {
                    return JSON.parse(decodeURIComponent(hash));
                } catch (e) {
                    return null;
                }
            }
            return null;
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª–µ–º –Ω–∞ —Å—Å—ã–ª–∫–∞—Ö
        function showSetPasswordModal(slug) {
            currentPasswordSlug = slug;
            document.getElementById('new-slug-password').value = '';
            document.getElementById('confirm-slug-password').value = '';
            document.getElementById('set-password-modal').style.display = 'flex';
        }

        function closeSetPasswordModal() {
            document.getElementById('set-password-modal').style.display = 'none';
            currentPasswordSlug = null;
        }

        function showRemovePasswordModal(slug) {
            currentPasswordSlug = slug;
            const shortUrl = window.location.origin + '/' + slug;
            document.getElementById('password-url-short').textContent = shortUrl;
            document.getElementById('remove-password-modal').style.display = 'flex';
        }

        function closeRemovePasswordModal() {
            document.getElementById('remove-password-modal').style.display = 'none';
            currentPasswordSlug = null;
        }

        async function confirmSetPassword() {
            const password = document.getElementById('new-slug-password').value;
            const confirmPassword = document.getElementById('confirm-slug-password').value;

            if (!password || !confirmPassword) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è.');
                return;
            }

            if (password !== confirmPassword) {
                alert('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç.');
                return;
            }

            if (password.length < 6) {
                alert('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤.');
                return;
            }

            const token = localStorage.getItem('access_token');
            if (!token || token === 'null') {
                alert('–¢–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É.');
                return;
            }

            try {
                const response = await fetch(`/auth/set_password_for_slug/${currentPasswordSlug}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ password_for_slug: password }),
                    credentials: 'include'
                });

                if (response.ok) {
                    alert('–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!');
                    closeSetPasswordModal();
                    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞—à–±–æ—Ä–¥
                    loadUrlHistory('dashboard-history-list');
                } else {
                    const error = await response.json();
                    alert('–û—à–∏–±–∫–∞: ' + (error.detail || '–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å'));
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –ø–∞—Ä–æ–ª—è:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –ø–∞—Ä–æ–ª—è.');
            }
        }

        async function confirmRemovePassword() {
            const token = localStorage.getItem('access_token');
            if (!token || token === 'null') {
                alert('–¢–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É.');
                return;
            }

            try {
                const response = await fetch(`/auth/remove_password_for_slug/${currentPasswordSlug}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    credentials: 'include'
                });

                if (response.ok) {
                    alert('–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω!');
                    closeRemovePasswordModal();
                    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞—à–±–æ—Ä–¥
                    loadUrlHistory('dashboard-history-list');
                } else {
                    const error = await response.json();
                    alert('–û—à–∏–±–∫–∞: ' + (error.detail || '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –ø–∞—Ä–æ–ª—å'));
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–∞—Ä–æ–ª—è:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–∞—Ä–æ–ª—è.');
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è –≤ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–Ω–∞—Ö
        function toggleNewSlugPassword() {
            const input = document.getElementById('new-slug-password');
            const icon = document.getElementById('new-slug-password-icon');
            if (input.type === 'password') {
                input.type = 'text';
                icon.textContent = 'üôà';
            } else {
                input.type = 'password';
                icon.textContent = 'üëÅÔ∏è';
            }
        }

        function toggleConfirmSlugPassword() {
            const input = document.getElementById('confirm-slug-password');
            const icon = document.getElementById('confirm-slug-password-icon');
            if (input.type === 'password') {
                input.type = 'text';
                icon.textContent = 'üôà';
            } else {
                input.type = 'password';
                icon.textContent = 'üëÅÔ∏è';
            }
        }
        console.log('=== –°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∂–µ–Ω ===');
    </script>
</body>
</html>